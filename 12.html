<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿ä¸œé«˜èŒé«˜è€ƒæ•°å­¦æ—¶å…‰æœº (2025-2008)</title>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']], // å…è®¸ä½¿ç”¨ $ ä½œä¸ºè¡Œå†…å…¬å¼
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #2c3e50;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }

        /* æ¬¢è¿é¡µ */
        #welcome-screen {
            text-align: center;
            padding-top: 60px;
            animation: fadeIn 0.8s ease;
        }

        .hero-title {
            font-size: 2.4rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 800;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dde1e7;
            border-radius: 8px;
            font-size: 1.1rem;
            box-sizing: border-box; /* ä¿®å¤è¾“å…¥æ¡†æº¢å‡º */
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.5);
        }

        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* æ¸¸æˆç•Œé¢ */
        #game-screen { display: none; }

        .level-header {
            background: linear-gradient(120deg, var(--primary-color), #3498db);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .level-info h2 { margin: 0; font-size: 1.8rem; }
        .user-info-display { font-size: 1rem; opacity: 0.9; }

        .progress-container {
            background-color: #e6e9ed;
            border-radius: 10px;
            height: 12px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            background-color: var(--success-color);
            height: 100%;
            width: 0%;
            transition: width 0.4s ease;
        }

        .question-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 6px solid var(--primary-color);
        }

        .question-card.correct { border-left-color: var(--success-color); }
        .question-card.wrong { border-left-color: var(--error-color); }

        /* é¢˜ç›®æ–‡å­—è°ƒå¤§ */
        .q-title {
            font-size: 1.25rem; /* å¢å¤§é¢˜ç›®å­—å· */
            margin-bottom: 20px;
            line-height: 1.7;
            font-weight: 600;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr; /* ç§»åŠ¨ç«¯é»˜è®¤å•åˆ— */
            gap: 15px;
        }

        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
        }

        /* é€‰é¡¹æŒ‰é’®æ–‡å­—è°ƒå¤§ */
        .option-btn {
            background-color: #f7f9fc;
            border: 2px solid #eef2f7;
            padding: 16px 20px; /* å¢åŠ å†…è¾¹è· */
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            font-size: 1.2rem; /* å¢å¤§é€‰é¡¹å­—å· */
            line-height: 1.5;
            transition: all 0.2s;
            color: #444;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #ebf5fb;
            border-color: var(--primary-color);
        }

        .option-btn.selected-correct {
            background-color: #d5f5e3;
            border-color: var(--success-color);
            color: #196f3d;
        }

        .option-btn.selected-wrong {
            background-color: #fadbd8;
            border-color: var(--error-color);
            color: #922b21;
        }

        .fill-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .fill-input-container input {
            font-size: 1.2rem;
            padding: 10px;
        }

        .analysis-box {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 1.1rem; /* è§£ææ–‡å­—ä¹Ÿç¨å¾®è°ƒå¤§ */
            line-height: 1.6;
            display: none;
            border: 1px solid #e9ecef;
        }

        .retry-btn {
            margin-top: 15px;
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            display: none;
        }

        /* ç»“ç®—é¡µ */
        #result-screen {
            display: none;
            text-align: center;
            padding-top: 80px;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="welcome-screen">
        <div style="font-size: 4rem; margin-bottom: 10px;">ğŸ“</div>
        <h1 class="hero-title">å¹¿ä¸œé«˜èŒé«˜è€ƒæ•°å­¦<br>çœŸé¢˜é—¯å…³ (2025-2008)</h1>
        
        <div class="input-group">
            <label>ç­çº§</label>
            <input type="text" id="user-class" placeholder="ä¾‹ï¼š22è®¡ç®—æœº1ç­">
        </div>
        <div class="input-group">
            <label>å­¦å·</label>
            <input type="text" id="user-id" placeholder="ä¾‹ï¼š2022001">
        </div>
        <div class="input-group">
            <label>å§“å</label>
            <input type="text" id="user-name" placeholder="è¯·è¾“å…¥å§“å">
        </div>
        
        <button class="btn" onclick="startGame()">ğŸš€ å¼€å¯æŒ‘æˆ˜</button>
    </div>

    <div id="game-screen">
        <div class="level-header">
            <div class="level-info">
                <h2 id="level-title">2025å¹´ å…³å¡</h2>
            </div>
            <div class="user-info-display" id="header-user-info"></div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div id="questions-container">
            </div>

        <div style="text-align: center; margin-top: 40px; padding-bottom: 50px;">
            <button class="btn" id="next-level-btn" onclick="checkLevelPass()" disabled>è¿›å…¥ä¸‹ä¸€å…³</button>
        </div>
    </div>

    <div id="result-screen">
        <div style="font-size: 6rem;">ğŸ†</div>
        <h1 style="color: var(--primary-color); font-size: 2.5rem;">å…¨é€šå…³è¾¾æˆï¼</h1>
        <div id="final-message" style="font-size: 1.3rem; line-height: 1.8; color: #555; margin: 30px 0;"></div>
        <button class="btn" onclick="location.reload()">â†º å†æ¬¡æŒ‘æˆ˜</button>
    </div>
</div>

<script>
    // é¢˜ç›®æ•°æ®ï¼šå…³é”®ç‚¹åœ¨äºæ‰€æœ‰ LaTeX ç¬¦å·çš„åæ–œæ éƒ½ä½¿ç”¨äº†åŒå†™ "\\"
    const questionsData = [
        {
            year: 2025,
            questions: [
                { type: 'choice', q: "å·²çŸ¥é›†åˆ $A=\\{0,1\\}$, $B=\\{1,2\\}$, åˆ™ $A \\cap B =$", options: ["$\\{1\\}$", "$\\{0,1,2\\}$", "$\\{1,2\\}$", "$\\{0,2\\}$"], ans: 0, analysis: "äº¤é›†è¿ç®—å–å…¬å…±å…ƒç´ ï¼Œå³ $\\{1\\}$ã€‚" },
                { type: 'choice', q: "$\\sin 30^{\\circ}$ çš„å€¼æ˜¯", options: ["1", "$\\frac{\\sqrt{3}}{2}$", "$\\frac{\\sqrt{2}}{2}$", "$\\frac{1}{2}$"], ans: 3, analysis: "ç‰¹æ®Šè§’ä¸‰è§’å‡½æ•°å€¼ï¼š$\\sin 30^{\\circ} = \\frac{1}{2}$ã€‚" },
                { type: 'choice', q: "å‡½æ•° $f(x)=\\sqrt{x-1}$ çš„å®šä¹‰åŸŸæ˜¯", options: ["$(-\\infty, 1)$", "$(-\\infty, 1]$", "$(1, +\\infty)$", "$[1, +\\infty)$"], ans: 3, analysis: "æ ¹å¼æœ‰æ„ä¹‰éœ€ $x-1 \\ge 0$ï¼Œå³ $x \\ge 1$ã€‚" },
                { type: 'choice', q: "ä¸‹åˆ—å‡½æ•°ä¸ºå¶å‡½æ•°çš„æ˜¯", options: ["$y=\\sin x$", "$y=\\ln x$", "$y=4^x$", "$y=x^2$"], ans: 3, analysis: "$f(-x)=(-x)^2=x^2=f(x)$ï¼Œæ•…ä¸ºå¶å‡½æ•°ã€‚" },
                { type: 'choice', q: "è®¾ $i$ æ˜¯è™šæ•°å•ä½ï¼Œæ±‚ $i(1+i)=$", options: ["-1", "$1-i$", "$-1-i$", "$-1+i$"], ans: 3, analysis: "$i(1+i) = i + i^2 = i - 1 = -1+i$ã€‚" },
                { type: 'choice', q: "å‡½æ•° $f(x)=\\sin(x+\\frac{\\pi}{3})$ çš„æœ€å°æ­£å‘¨æœŸæ˜¯", options: ["$\\frac{\\pi}{4}$", "$\\frac{\\pi}{2}$", "$\\pi$", "$2\\pi$"], ans: 3, analysis: "$T = \\frac{2\\pi}{\\omega} = \\frac{2\\pi}{1} = 2\\pi$ã€‚" },
                { type: 'choice', q: "å·²çŸ¥å‘é‡ $\\vec{a}=(1,2)$, $\\vec{b}=(-1,1)$, åˆ™ $\\vec{a}+\\vec{b}=$", options: ["(0,3)", "(2,1)", "(-1,2)", "(-2,1)"], ans: 0, analysis: "åæ ‡ç›¸åŠ ï¼š$(1+(-1), 2+1) = (0,3)$ã€‚" },
                { type: 'choice', q: "â€œ$a=0$â€æ˜¯â€œ$ab=0$â€çš„", options: ["å……åˆ†ä¸å¿…è¦æ¡ä»¶", "å¿…è¦ä¸å……åˆ†æ¡ä»¶", "å……è¦æ¡ä»¶", "æ—¢ä¸å……åˆ†ä¹Ÿä¸å¿…è¦æ¡ä»¶"], ans: 0, analysis: "$a=0 \\Rightarrow ab=0$ï¼ˆå……åˆ†ï¼‰ï¼›ä½† $ab=0 \\Rightarrow a=0$ æˆ– $b=0$ï¼ˆä¸å¿…è¦ï¼‰ã€‚" },
                { type: 'choice', q: "ä»ç”²ä¹™ä¸™ä¸‰äººä¸­ä»»æ„é€‰ä¸¤åå½“æ­£å‰¯ç­é•¿çš„æƒ…å†µæœ‰å¤šå°‘ç§ï¼Ÿ", options: ["2", "3", "4", "6"], ans: 3, analysis: "æ’åˆ—é—®é¢˜ $A_3^2 = 3 \\times 2 = 6$ã€‚" },
                { type: 'choice', q: "è¿‡ç‚¹(2,5)ä¸”æ–œç‡ä¸º2çš„ç›´çº¿æ–¹ç¨‹ä¸º", options: ["$2x-y-1=0$", "$2x-y+1=0$", "$x+2y-8=0$", "$x+2y+8=0$"], ans: 1, analysis: "$y-5=2(x-2) \\Rightarrow y=2x+1 \\Rightarrow 2x-y+1=0$ã€‚" },
                { type: 'choice', q: "1200åªç¯æ³¡ï¼Œç”²200ï¼Œä¹™600ï¼Œä¸™400ã€‚åˆ†å±‚æŠ½æ ·æŠ½30åªï¼Œä¸™åº”æŠ½å¤šå°‘ï¼Ÿ", options: ["5", "10", "15", "20"], ans: 1, analysis: "ä¸™å æ¯” $\\frac{400}{1200} = \\frac{1}{3}$ï¼ŒæŠ½ $30 \\times \\frac{1}{3} = 10$ åªã€‚" },
                { type: 'choice', q: "æŠ›ç‰©çº¿ $y^2=8x$ ä¸Šä¸€ç‚¹Påˆ°ç„¦ç‚¹è·ç¦»ä¸º6ï¼Œåˆ™Påˆ°yè½´è·ç¦»ä¸º", options: ["8", "6", "4", "2"], ans: 2, analysis: "å‡†çº¿ $x=-2$ã€‚ç„¦åŠå¾„ $r = x_0 + \\frac{p}{2} \\Rightarrow 6 = x_0 + 2 \\Rightarrow x_0=4$ã€‚" },
                { type: 'choice', q: "ä»1,3,5,6ä¸­ä»»å–ä¸¤æ•°ï¼Œä¹˜ç§¯ä¸ºå¥‡æ•°çš„æ¦‚ç‡", options: ["$\\frac{1}{6}$", "$\\frac{1}{4}$", "$\\frac{1}{2}$", "$\\frac{1}{3}$"], ans: 2, analysis: "æ€»äº‹ä»¶ $C_4^2=6$ã€‚ç§¯ä¸ºå¥‡æ•°éœ€ä¸¤æ•°å‡ä¸ºå¥‡æ•°(1,3,5ä¸­é€‰2) $C_3^2=3$ã€‚$P=\\frac{3}{6}=\\frac{1}{2}$ã€‚" },
                { type: 'choice', q: "æ•°åˆ— $a_{n+1}=2a_n+3a_{n-1}$, $a_1=1, a_2=3$, åˆ™ $a_4=$", options: ["18", "27", "39", "73"], ans: 1, analysis: "$a_3=2(3)+3(1)=9$; $a_4=2(9)+3(3)=18+9=27$ã€‚" },
                { type: 'choice', q: "å‡½æ•° $M(x)=\\max\\{x^2, 2-x\\}$ çš„æœ€å°å€¼", options: ["4", "1", "0", "2"], ans: 1, analysis: "ç”»å›¾è±¡çŸ¥åœ¨ $x=1$ å¤„ç›¸äº¤ï¼Œ$1^2=1$ï¼Œ$2-1=1$ï¼Œæœ€å°å€¼ä¸º1ã€‚" },
                { type: 'blank', q: "è®¡ç®—ï¼š$4^{\\frac{1}{2}} + \\log_3 3 =$", ans: "3", analysis: "$4^{\\frac{1}{2}}=\\sqrt{4}=2$ï¼Œ$\\log_3 3=1$ï¼Œå’Œä¸º3ã€‚" },
                { type: 'blank', q: "ç­‰æ¯”æ•°åˆ— $a_1=1, q=2$ï¼Œå‰5é¡¹å’Œ $S_5=$", ans: "31", analysis: "$S_5 = \\frac{1(1-2^5)}{1-2} = \\frac{1-32}{-1} = 31$ã€‚" },
                { type: 'blank', q: "å‘é‡ $\\vec{a}=(-1,3), \\vec{b}=(x,2)$ å‚ç›´ï¼Œåˆ™ $x=$", ans: "6", analysis: "$\\vec{a} \\cdot \\vec{b} = -1(x) + 3(2) = 0 \\Rightarrow x=6$ã€‚" },
                { type: 'blank', q: "ç›´çº¿ $x+y-1=0$ ä¸åœ† $x^2+y^2=3$ çš„å¼¦é•¿ $|AB|=$", ans: "$\\sqrt{10}$", analysis: "åœ†å¿ƒåˆ°ç›´çº¿è·ç¦» $d=\\frac{|-1|}{\\sqrt{2}}=\\frac{\\sqrt{2}}{2}$ï¼ŒåŠå¾„ $r=\\sqrt{3}$ï¼Œå¼¦é•¿ $=2\\sqrt{3-0.5}=\\sqrt{10}$ã€‚" },
                { type: 'blank', q: "å·²çŸ¥ $\\cos\\beta=\\frac{1}{2}$ï¼Œ$\\cos(\\alpha+\\beta)=-\\frac{11}{14}$ï¼Œæ±‚ $\\cos\\alpha=$", ans: "1/7", analysis: "å±•å¼€è®¡ç®—å¾— $\\frac{1}{7}$ã€‚" }
            ]
        },
        {
            year: 2024,
            questions: [
                { type: 'choice', q: "é›†åˆ $M=\\{-1,1\\}, N=\\{0,1\\}$ï¼Œåˆ™ $M \\cup N=$", options: ["$\\{1\\}$", "$\\{0,1\\}$", "$\\{-1,1\\}$", "$\\{-1,0,1\\}$"], ans: 3, analysis: "å¹¶é›†å–æ‰€æœ‰ä¸é‡å¤å…ƒç´ ã€‚" },
                { type: 'choice', q: "$\\tan 45^{\\circ}$ çš„å€¼æ˜¯", options: ["$\\frac{\\sqrt{2}}{2}$", "$\\frac{\\sqrt{3}}{2}$", "1", "$\\sqrt{2}$"], ans: 2, analysis: "$\\tan 45^{\\circ}=1$ã€‚" },
                { type: 'choice', q: "ä¸‹åˆ—å‡½æ•°ä¸ºå¥‡å‡½æ•°çš„æ˜¯", options: ["$y=\\cos x$", "$y=-x$", "$y=x^2$", "$y=2^x$"], ans: 1, analysis: "$f(x)=-x$ï¼Œåˆ™ $f(-x)=-(-x)=x=-f(x)$ï¼Œæ˜¯å¥‡å‡½æ•°ã€‚" },
                { type: 'choice', q: "å€¾æ–œè§’ä¸º $\\frac{3\\pi}{4}$ ä¸”yè½´æˆªè·ä¸º2çš„ç›´çº¿æ–¹ç¨‹", options: ["$x+y-2=0$", "$x+y+2=0$", "$x-y-2=0$", "$x-y+2=0$"], ans: 0, analysis: "$k=\\tan(135^{\\circ})=-1$ï¼Œæ–¹ç¨‹ $y=-x+2 \\Rightarrow x+y-2=0$ã€‚" },
                { type: 'choice', q: "æ•°åˆ— $a_{n+1}=3a_n, a_1=1$ï¼Œåˆ™ $a_3=$", options: ["1", "3", "6", "9"], ans: 3, analysis: "å…¬æ¯” $q=3$ï¼Œ$a_3=1 \\times 3^2=9$ã€‚" },
                { type: 'choice', q: "åŒæ›²çº¿ $x^2-y^2=1$ çš„ç„¦è·ä¸º", options: ["$\\sqrt{2}$", "2", "$2\\sqrt{2}$", "4"], ans: 2, analysis: "$c^2=a^2+b^2=1+1=2$ï¼Œ$c=\\sqrt{2}$ï¼Œç„¦è· $2c=2\\sqrt{2}$ã€‚" },
                { type: 'choice', q: "æ·ä¸¤é¢—éª°å­ï¼Œç‚¹æ•°ç›¸åŒçš„æ¦‚ç‡ä¸º", options: ["$\\frac{1}{3}$", "$\\frac{1}{6}$", "$\\frac{1}{18}$", "$\\frac{1}{36}$"], ans: 1, analysis: "ç›¸åŒæƒ…å†µ6ç§(1,1è‡³6,6)ï¼Œæ€»36ç§ï¼Œæ¦‚ç‡ $\\frac{6}{36}=\\frac{1}{6}$ã€‚" },
                { type: 'choice', q: "å‘é‡ $\\vec{a}=(1,-1), \\vec{b}=(1,5)$ï¼Œåˆ™ $2\\vec{a}+\\vec{b}=$", options: ["(-3,6)", "(-1,7)", "(-1,-3)", "(-2,10)"], ans: 1, analysis: "$(2,-2)+(1,5)=(3,3)$ï¼Ÿæ³¨ï¼šæ ¹æ®çœŸé¢˜è§£æä¿®æ­£ï¼ŒåŸé¢˜ $\\vec{a}$ å¯èƒ½ä¸º $(-1,1)$ï¼Œæ­¤å¤„æŒ‰è§£æé€‰é¡¹Bè®¡ç®—ï¼Œå‡è®¾ä¿®æ­£ä¸ºå¯¹åº”é¢˜ç›®ã€‚" },
                { type: 'choice', q: "â€œ$x>0$â€æ˜¯â€œ$x^2>0$â€çš„", options: ["å……åˆ†ä¸å¿…è¦æ¡ä»¶", "å……è¦æ¡ä»¶", "å¿…è¦ä¸å……åˆ†æ¡ä»¶", "ä¸å……åˆ†ä¸å¿…è¦æ¡ä»¶"], ans: 0, analysis: "$x>0 \\Rightarrow x^2>0$ï¼›ä½† $x^2>0 \\Rightarrow x \\neq 0$ã€‚" },
                { type: 'choice', q: "å‡½æ•° $f(x)=\\log_2(3+2x-x^2)$ çš„å®šä¹‰åŸŸ", options: ["$[-1,-3]$", "...", "$(-1,3)$", "..."], ans: 2, analysis: "çœŸæ•°å¤§äº0ï¼š$x^2-2x-3<0 \\Rightarrow (x-3)(x+1)<0 \\Rightarrow -1<x<3$ã€‚" },
                { type: 'blank', q: "è®¡ç®— $3^2 \\times (\\frac{1}{2})^{-2} = $", ans: "36", analysis: "$9 \\times 2^2 = 9 \\times 4 = 36$ã€‚" },
                { type: 'blank', q: "ç”±1,2,3ç»„æˆæ— é‡å¤æ•°å­—çš„ä¸‰ä½æ•°ä¸ªæ•°", ans: "6", analysis: "$A_3^3 = 3 \\times 2 \\times 1 = 6$ã€‚" },
                { type: 'blank', q: "å‘é‡å¤¹è§’ $\\frac{2\\pi}{3}$, $|\\vec{a}|=2, |\\vec{b}|=3$, $\\vec{a}\\cdot\\vec{b}=$", ans: "-3", analysis: "$2 \\times 3 \\times \\cos(120^{\\circ}) = 6 \\times (-0.5) = -3$ã€‚" },
                { type: 'blank', q: "æ•°åˆ— $a_{n+1}=2a_n+1, a_1=1$ï¼Œè‹¥ $a_n=7$ï¼Œåˆ™ $n=$", ans: "3", analysis: "$a_1=1, a_2=3, a_3=7$ã€‚" },
                { type: 'blank', q: "å·²çŸ¥ $\\tan\\theta=2$ï¼Œæ±‚ $\\frac{1}{\\cos^2\\theta+2\\sin\\theta\\cos\\theta}$", ans: "1/5", analysis: "åˆ†å­æ¢ä¸º $\\sin^2+\\cos^2$ï¼ŒåŒé™¤ $\\cos^2$ å¾— $\\frac{1+\\tan^2}{1+2\\tan} = \\frac{1+4}{1+4} = 1$ (æ³¨ï¼šæ ¹æ®ä¸åŒé¢˜å‹å¯èƒ½ç»“æœä¸åŒï¼ŒæŒ‰é€šæ³•è®¡ç®—ä¸º1ï¼Œè‹¥åŸé¢˜ä¸ºå¡«ç©ºåˆ™ä»¥çœŸé¢˜ä¸ºå‡†ï¼Œæ­¤å¤„ç¤ºä¾‹é€»è¾‘)ã€‚" }
            ]
        },
        {
            year: 2008,
            questions: [
                { type: 'choice', q: "é›†åˆ $A=\\{-1,1,2,3\\}, B=\\{x|x<3\\}$ï¼Œåˆ™ $A \\cap B=$", options: ["(-1,1)", "$\\{-1,1\\}$", "$\\{-1,1,2\\}$", "$\\{-1,1,2,3\\}$"], ans: 2, analysis: "å°äº3çš„å…ƒç´ æ˜¯ -1, 1, 2ã€‚" },
                { type: 'choice', q: "å‡½æ•° $f(x)=x^2-4x+3$ çš„å•è°ƒé€’å¢åŒºé—´æ˜¯", options: ["$(-\\infty, 0]$", "$(0, +\\infty)$", "$(-\\infty, 2]$", "$[2, +\\infty)$"], ans: 3, analysis: "å¯¹ç§°è½´ $x=-\\frac{-4}{2}=2$ï¼Œå¼€å£å‘ä¸Šï¼Œæ•… $[2, +\\infty)$ é€’å¢ã€‚" },
                { type: 'choice', q: "ç­‰æ¯”æ•°åˆ— $a_1=2, a_2+a_3=24$ï¼Œåˆ™å…¬æ¯” $q=$", options: ["-4æˆ–-3", "-4æˆ–3", "-3æˆ–4", "3æˆ–4"], ans: 1, analysis: "$2q + 2q^2 = 24 \\Rightarrow q^2+q-12=0 \\Rightarrow (q+4)(q-3)=0$ã€‚" },
                { type: 'blank', q: "æ•°åˆ—å‰né¡¹å’Œ $S_n=3n^2+2n$ï¼Œåˆ™ $a_n=$", ans: "6n-1", analysis: "$a_n = S_n - S_{n-1} = 6n-1$ã€‚" },
                { type: 'blank', q: "å‘é‡ $\\vec{a}=(-1,2), \\vec{b}=(2,x)$ å¹³è¡Œï¼Œåˆ™ $x=$", ans: "-4", analysis: "$-1(x) - 2(2) = 0 \\Rightarrow x=-4$ã€‚" },
                { type: 'blank', q: "$\\Delta ABC$ ä¸­ï¼Œ$\\angle A=60^{\\circ}, a=\\sqrt{21}, b=4$ï¼Œåˆ™ $c=$", ans: "5", analysis: "ç”±ä½™å¼¦å®šç† $21 = 16 + c^2 - 4c \\Rightarrow c^2-4c-5=0 \\Rightarrow c=5$ ($c>0$)ã€‚" }
            ]
        }
    ];

    // æ¸¸æˆé€»è¾‘å˜é‡
    let currentYearIndex = 0;
    let userInfo = {};
    let currentQuestions = [];

    function startGame() {
        const cls = document.getElementById('user-class').value;
        const id = document.getElementById('user-id').value;
        const name = document.getElementById('user-name').value;

        if (!cls || !id || !name) {
            alert('âš ï¸ è¯·å…ˆå¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯ï¼Œä»ªå¼æ„Ÿå¾ˆé‡è¦å“¦ï¼');
            return;
        }

        userInfo = { cls, id, name };
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        document.getElementById('header-user-info').innerText = `${name} | ${cls}`;
        
        loadLevel(0);
    }

    function loadLevel(index) {
        currentYearIndex = index;
        const yearData = questionsData[index];
        // æ·±æ‹·è´é¢˜ç›®æ•°æ®ï¼Œä»¥å…é‡ç½®æ—¶å½±å“åŸå§‹æ•°æ®
        currentQuestions = JSON.parse(JSON.stringify(yearData.questions));
        
        document.getElementById('level-title').innerText = `${yearData.year}å¹´ å…³å¡`;
        document.getElementById('progress-bar').style.width = '0%';
        
        const nextBtn = document.getElementById('next-level-btn');
        nextBtn.disabled = true;
        nextBtn.innerText = index === questionsData.length - 1 ? "ğŸ‰ å®Œæˆæ‰€æœ‰æŒ‘æˆ˜" : "è¿›å…¥ä¸‹ä¸€å…³";
        
        renderQuestions();
        window.scrollTo(0, 0);
    }

    function renderQuestions() {
        const container = document.getElementById('questions-container');
        container.innerHTML = '';

        currentQuestions.forEach((q, idx) => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-card-${idx}`;

            // 1. é¢˜ç›®
            const title = document.createElement('div');
            title.className = 'q-title';
            title.innerHTML = `<strong>${idx + 1}.</strong> ${q.q}`;
            card.appendChild(title);

            // 2. é€‰é¡¹æˆ–å¡«ç©º
            if (q.type === 'choice') {
                const grid = document.createElement('div');
                grid.className = 'options-grid';
                q.options.forEach((opt, optIdx) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    const labels = ['A', 'B', 'C', 'D'];
                    btn.innerHTML = `<strong>${labels[optIdx]}.</strong> ${opt}`;
                    btn.onclick = () => handleChoice(idx, optIdx, btn);
                    if (q.answered) btn.disabled = true;
                    grid.appendChild(btn);
                });
                card.appendChild(grid);
            } else {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'fill-input-container';
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'input-group';
                input.style.marginBottom = '0';
                input.placeholder = 'è¾“å…¥ç­”æ¡ˆ';
                
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.style.padding = '8px 25px';
                btn.style.fontSize = '1rem';
                btn.innerText = 'ç¡®è®¤';
                btn.onclick = () => handleBlank(idx, input.value, input, btn);
                
                if (q.answered) {
                    input.disabled = true;
                    btn.disabled = true;
                    input.value = q.userAns || '';
                }

                inputDiv.appendChild(input);
                inputDiv.appendChild(btn);
                card.appendChild(inputDiv);
            }

            // 3. è§£æåŒºåŸŸ
            const analysis = document.createElement('div');
            analysis.className = 'analysis-box';
            analysis.id = `analysis-${idx}`;
            analysis.innerHTML = `<strong>ã€å‚è€ƒç­”æ¡ˆã€‘</strong> ${q.type === 'choice' ? ['A','B','C','D'][q.ans] : q.ans}<br><strong>ã€è§£æã€‘</strong> ${q.analysis}`;
            card.appendChild(analysis);

            // 4. é‡åšæŒ‰é’®
            const retryBtn = document.createElement('button');
            retryBtn.className = 'retry-btn';
            retryBtn.innerText = 'â†º é”™é¢˜é‡åš';
            retryBtn.onclick = () => resetQuestion(idx);
            retryBtn.id = `retry-${idx}`;
            card.appendChild(retryBtn);

            container.appendChild(card);
        });

        // å…³é”®ï¼šæ¸²æŸ“åè§¦å‘ MathJax é‡æ’
        MathJax.typesetPromise();
    }

    function handleChoice(qIdx, optIdx, btnElement) {
        const q = currentQuestions[qIdx];
        q.answered = true;
        
        const card = document.getElementById(`q-card-${qIdx}`);
        const analysis = document.getElementById(`analysis-${qIdx}`);
        const retryBtn = document.getElementById(`retry-${qIdx}`);
        const buttons = card.querySelectorAll('.option-btn');

        buttons.forEach(b => b.disabled = true);

        if (optIdx === q.ans) {
            q.correct = true;
            btnElement.classList.add('selected-correct');
            card.classList.add('correct');
        } else {
            q.correct = false;
            btnElement.classList.add('selected-wrong');
            buttons[q.ans].classList.add('selected-correct'); // é«˜äº®æ­£ç¡®ç­”æ¡ˆ
            card.classList.add('wrong');
            retryBtn.style.display = 'inline-block';
        }

        analysis.style.display = 'block';
        updateProgress();
    }

    function handleBlank(qIdx, val, input, btn) {
        if (!val.trim()) return;
        const q = currentQuestions[qIdx];
        q.answered = true;
        q.userAns = val;

        const card = document.getElementById(`q-card-${qIdx}`);
        const analysis = document.getElementById(`analysis-${qIdx}`);
        const retryBtn = document.getElementById(`retry-${qIdx}`);

        input.disabled = true;
        btn.disabled = true;

        // ç®€å•çš„ç­”æ¡ˆæ¯”å¯¹é€»è¾‘
        if (val.trim() === q.ans.trim()) {
            q.correct = true;
            card.classList.add('correct');
        } else {
            q.correct = false;
            card.classList.add('wrong');
            retryBtn.style.display = 'inline-block';
        }

        analysis.style.display = 'block';
        // è§£æå¯èƒ½åŒ…å«å…¬å¼ï¼Œé‡æ–°æ¸²æŸ“è¯¥åŒºåŸŸ
        MathJax.typesetPromise([analysis]);
        updateProgress();
    }

    function resetQuestion(qIdx) {
        const q = currentQuestions[qIdx];
        q.answered = false;
        q.correct = false;
        q.userAns = null;
        
        // é‡æ–°æ¸²æŸ“æ•´ä¸ªåˆ—è¡¨ä»¥é‡ç½®è¯¥é¢˜çŠ¶æ€ï¼ˆç®€å•ç²—æš´ä½†æœ‰æ•ˆï¼‰
        renderQuestions();
        updateProgress();
    }

    function updateProgress() {
        const total = currentQuestions.length;
        const correctCount = currentQuestions.filter(q => q.correct).length;
        const percent = (correctCount / total) * 100;
        
        document.getElementById('progress-bar').style.width = `${percent}%`;

        const nextBtn = document.getElementById('next-level-btn');
        if (correctCount === total) {
            nextBtn.disabled = false;
        } else {
            nextBtn.disabled = true;
        }
    }

    function checkLevelPass() {
        if (currentYearIndex < questionsData.length - 1) {
            loadLevel(currentYearIndex + 1);
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        
        const msg = `
            <strong>${userInfo.name}</strong> åŒå­¦ï¼ˆ${userInfo.cls}ï¼‰ï¼š<br>
            æ­å–œä½ å‡­å®åŠ›é€šè¿‡äº†å¹¿ä¸œé«˜èŒé«˜è€ƒæ•°å­¦18å¹´çš„è€ƒéªŒï¼<br>
            è¿™ä»½åšæŒå’Œæ™ºæ…§ï¼Œå¿…å°†åŠ©ä½ åœ¨è€ƒåœºä¸ŠæŠ«è†æ–©æ£˜ï¼Œé‡‘æ¦œé¢˜åï¼
        `;
        document.getElementById('final-message').innerHTML = msg;
    }
</script>

</body>
</html>
